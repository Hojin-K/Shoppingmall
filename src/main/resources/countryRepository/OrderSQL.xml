<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.myapp.repository.OrderRepository">

    <resultMap id="order" type="com.shop.myapp.dto.Order">
        <id property="orderCode" column="order_code"/>
        <id property="totalPay" column="total_pay"/>
        <id property="memberId" column="member_id"/>
        <id property="buyerName" column="buyer_name"/>
        <id property="buyerEmail" column="buyer_email"/>
        <id property="buyerAddr" column="buyer_addr"/>
        <id property="buyerPostCode" column="buyer_post_code"/>
        <collection property="orderDetails" ofType="com.shop.myapp.dto.OrderDetail" javaType="java.util.List">
            <result property="orderDetailCode" column="order_detail_code"/>
            <result property="orderCode" column="order_code"/>
            <result property="optionCode" column="option_code"/>
            <result property="amount" column="amount"/>
            <result property="postedStatus" column="posted_status"/>
        </collection>
    </resultMap>
    <insert id="insertOrder">
        insert into SHOP_ORDER_TB (order_code, member_id, total_pay,
                                   buyer_name, buyer_tel,
                                   buyer_email, buyer_addr, buyer_post_code)
        values (#{orderCode},
                #{memberId},
                #{totalPay},
                #{buyerName},
                #{buyerTel},
                #{buyerEmail},
                #{buyerAddr},
                #{buyerPostCode})
    </insert>
    <update id="updateIsPaidIntByOrderCode">
        update SHOP_ORDER_TB
        set IS_PAID = 'Paid'
        where ORDER_CODE = #{orderCode}
    </update>
    <delete id="deleteOrderByOrderCode">
        delete SHOP_ORDER_TB
        where ORDER_CODE = #{orderCode}
    </delete>
    <select id="findOrderByMemberId" resultMap="order">
        select *
        from HR.SHOP_ORDER_TB O,
             HR.SHOP_ORDER_DETAIL_TB D
        where O.MEMBER_ID = #{memberId}
          and O.order_code = D.order_code
    </select>
    <select id="findByOrderCode" resultMap="order">
        select *
        from HR.SHOP_ORDER_TB O,
             HR.SHOP_ORDER_DETAIL_TB D
        where O.ORDER_CODE = #{orderCode}
          and D.order_code = O.order_code
    </select>
</mapper>